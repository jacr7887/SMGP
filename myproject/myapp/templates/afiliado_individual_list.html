{% extends "base.html" %}
{% load static %}

{% block title %}Listado de Afiliados Individuales{% endblock %}

{% block content %}
<div class="container" role="main" aria-labelledby="main-heading">
  <section>
    <h1 id="main-heading">üìã Listado de Afiliados Individuales</h1>

    <div class="header-actions">
      {% if perms.myapp.add_afiliadoindividual %}
      <a href="{% url 'myapp:afiliado_individual_create' %}" class="nav_link">
        ‚ûï Nuevo Afiliado
      </a>
      {% endif %}
    </div>

    <div class="table-container">
      <table id="afiliados-table" class="data-table" style="width:100%" data-custom-init="true">
        <thead>
          <tr>
            <th>Nombre Completo</th>
            <th>C√©dula</th>
            <th>Edad</th>
            <th>Activo</th>
            <th>Parentesco</th>
            <th>Estado Civil</th>
            <th>Sexo</th>
            <th>Tipo ID</th>
            <th>Intermediario</th>
            <th>Fecha Nacimiento</th>
            <th>Nacionalidad</th>
            <th>Zona Postal</th>
            <th>Estado</th>
            <th>Municipio</th>
            <th>Ciudad</th>
            <th>Fecha Ingreso</th>
            <th>Direcci√≥n Habitaci√≥n</th>
            <th>Tel√©fono Habitaci√≥n</th>
            <th>Email</th>
            <th>Direcci√≥n Oficina</th>
            <th>Tel√©fono Oficina</th>
            <th>C√≥digo Validaci√≥n</th>
            <th>Fecha Creaci√≥n</th>
            <th>√öltima Modificaci√≥n</th>
            <th class="no-sort">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for afiliado in object_list %}
            {% if afiliado.decryption_error %}
              <tr class="table-danger">
                <td colspan="25">‚ö†Ô∏è Error al leer datos para el afiliado con ID: {{ afiliado.pk }}. Por favor, revise este registro en el admin.</td>
              </tr>
            {% else %}
              <tr>
                <td><a href="{% url 'myapp:afiliado_individual_detail' afiliado.pk %}">{{ afiliado.nombre_completo|default:"N/A"|escape }}</a></td>
                <td>{{ afiliado.cedula|default:"N/A"|escape }}</td>
                <td>{{ afiliado.edad|default:"N/A" }}</td>
                <td>
                  {% if afiliado.activo %}<span class="badge badge-success">Activo</span>
                  {% else %}<span class="badge badge-danger">Inactivo</span>{% endif %}
                </td>
                <td>
                  {% if afiliado.parentesco == 'TITULAR' %}<span class="badge badge-primary">{{ afiliado.get_parentesco_display }}</span>
                  {% elif afiliado.parentesco == 'CONYUGE' %}<span class="badge badge-relationship">{{ afiliado.get_parentesco_display }}</span>
                  {% elif afiliado.parentesco == 'HIJO' %}<span class="badge badge-info">{{ afiliado.get_parentesco_display }}</span>
                  {% elif afiliado.parentesco == 'PADRE' or afiliado.parentesco == 'MADRE' %}<span class="badge badge-special">{{ afiliado.get_parentesco_display }}</span>
                  {% elif afiliado.parentesco == 'HERMANO' %}<span class="badge badge-action">{{ afiliado.get_parentesco_display }}</span>
                  {% else %}<span class="badge badge-secondary">{{ afiliado.get_parentesco_display }}</span>{% endif %}
                </td>
                <td>
                  {% if afiliado.estado_civil == 'C' %}<span class="badge badge-relationship">Casado/a</span>
                  {% elif afiliado.estado_civil == 'S' %}<span class="badge badge-success">Soltero/a</span>
                  {% elif afiliado.estado_civil == 'V' %}<span class="badge badge-dark">Viudo/a</span>
                  {% elif afiliado.estado_civil == 'D' %}<span class="badge badge-warning">Divorciado/a</span>
                  {% else %}<span class="badge badge-secondary">{{ afiliado.get_estado_civil_display }}</span>{% endif %}
                </td>
                <td>
                  {% if afiliado.sexo == 'F' %}<span class="badge badge-relationship">Femenino</span>
                  {% elif afiliado.sexo == 'M' %}<span class="badge badge-primary">Masculino</span>
                  {% elif afiliado.sexo == 'NO_BINARIO' %}<span class="badge badge-system">No Binario</span>
                  {% else %}<span class="badge badge-info">{{ afiliado.get_sexo_display }}</span>{% endif %}
                </td>
                <td>
                  {% if afiliado.tipo_identificacion == 'CEDULA' %}<span class="badge badge-success">C√©dula</span>
                  {% elif afiliado.tipo_identificacion == 'PASAPORTE' %}<span class="badge badge-dark">Pasaporte</span>
                  {% elif afiliado.tipo_identificacion == 'RIF' %}<span class="badge badge-system">RIF</span>
                  {% else %}<span class="badge badge-secondary">{{ afiliado.get_tipo_identificacion_display }}</span>{% endif %}
                </td>
                <td>{{ afiliado.intermediario.nombre_completo|escape|default:"-" }}</td>
                <td>{{ afiliado.fecha_nacimiento|date:"d/m/Y"|default:"N/A" }}</td>
                <td>{{ afiliado.nacionalidad|escape|default:"N/A" }}</td>
                <td>{{ afiliado.zona_postal|escape|default:"N/A" }}</td>
                <td>{{ afiliado.get_estado_display|escape|default:"N/A" }}</td>
                <td>{{ afiliado.municipio|escape|default:"N/A" }}</td>
                <td>{{ afiliado.ciudad|escape|default:"N/A" }}</td>
                <td>{{ afiliado.fecha_ingreso|date:"d/m/Y"|default:"N/A" }}</td>
                <td>{{ afiliado.direccion_habitacion|truncatechars:30|escape|default:"N/A" }}</td>
                <td>{{ afiliado.telefono_habitacion|escape|default:"N/A" }}</td>
                <td>{{ afiliado.email|escape|default:"N/A" }}</td>
                <td>{{ afiliado.direccion_oficina|truncatechars:30|escape|default:"N/A" }}</td>
                <td>{{ afiliado.telefono_oficina|escape|default:"N/A" }}</td>
                <td>{{ afiliado.codigo_validacion|escape|default:"N/A" }}</td>
                <td>{{ afiliado.fecha_creacion|date:"d/m/Y H:i" }}</td>
                <td>{{ afiliado.fecha_modificacion|date:"d/m/Y H:i" }}</td>
                <td class="actions">
                  <div class="action-group">
                    <a href="{% url 'myapp:afiliado_individual_detail' afiliado.pk %}" class="action-icon" title="Ver Detalles">üëÅÔ∏è</a>
                    {% if perms.myapp.change_afiliadoindividual %}
                    <a href="{% url 'myapp:afiliado_individual_update' afiliado.pk %}" class="action-icon" title="Editar">‚úèÔ∏è</a>
                    {% endif %}
                    {% if perms.myapp.delete_afiliadoindividual %}
                    <a href="{% url 'myapp:afiliado_individual_delete' afiliado.pk %}" class="action-icon delete-link" title="Eliminar" data-confirm="¬øEst√° seguro?">‚ùå</a>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock content %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
    $('#afiliados-table').DataTable({
        language: { "url": "{% get_static_prefix %}es-ES.json" },
        "dom": "<'dt-layout-row'<'dt-layout-cell dt-start'l><'dt-layout-cell dt-end'f>><'dt-layout-row'<'dt-layout-cell dt-full-width'tr>><'dt-layout-row'<'dt-layout-cell dt-start'i><'dt-layout-cell dt-end'p>>",
        "columnDefs": [{ "orderable": false, "targets": -1 }],
        "order": [[ 0, "asc" ]]
    });
});
</script>
{% endblock %}