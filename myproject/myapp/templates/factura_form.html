{% extends "base.html" %} {# Aseg√∫rate que esta sea tu plantilla base correcta #}
{% load static %}


{% block title %}{% if form.instance.pk %}Editar Factura{% else %}Nueva Factura{% endif %}{% endblock %}


{% block content %}
<div class="dark-container" role="main" aria-labelledby="main-heading">
  <section>
    <h1 id="main-heading" class="main-title">
      {% if form.instance.pk %}‚úèÔ∏è Editar Factura{% else %}‚ûï Nueva Factura{% endif %}
    </h1>

    {# --- Bot√≥n Volver --- #}
    <div class="header-actions">
      <a href="{% url 'myapp:factura_list' %}" class="nav_link" aria-label="Volver al listado de facturas">
        ‚¨ÖÔ∏è Volver al Listado
      </a>
      {# Puedes a√±adir otros botones aqu√≠ si es necesario #}
    </div>

    {# --- Formulario Principal --- #}
    <form method="post" class="compact-form" enctype="multipart/form-data" aria-labelledby="main-heading" novalidate>
      {% csrf_token %}

      {# --- Errores Generales del Formulario --- #}
      {% if form.non_field_errors %}
          <div class="alert alert-danger error-summary" role="alert">
              <h4>‚ö†Ô∏è Errores Generales:</h4>
              <ul>
                  {% for error in form.non_field_errors %}
                      <li>{{ error|escape }}</li>
                  {% endfor %}
              </ul>
          </div>
      {% endif %}

      {# --- Fieldset: Contrato y Estatus --- #}
      <fieldset> {# Quit√© dark-group del fieldset, se aplica a cada campo individual #}
        <legend class="dark-label">üîó Contrato y Estatus</legend>
        <div class="dark-grid"> {# Usar grid para layout si lo deseas #}

            {# Campo Activo (Switch) #}
            <div class="dark-group {% if form.activo.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.activo.id_for_label }}">üí° {{ form.activo.label }}</label>
                <label class="switch"> {# Label envolvente para el estilo switch #}
                    {{ form.activo }} {# Renderiza el <input type="checkbox"> #}
                    <span class="slider"></span> {# Span para el estilo CSS #}
                </label>
                {% if form.activo.errors %}<ul class="error-messages">{% for error in form.activo.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.activo.help_text %}<small class="form-text text-muted">{{ form.activo.help_text }}</small>{% endif %}
            </div>

            {# Campo Contrato Individual (Select2) #}
            <div class="dark-group {% if form.contrato_individual.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.contrato_individual.id_for_label }}">üìÑ {{ form.contrato_individual.label }}</label>
                {{ form.contrato_individual }} {# Renderiza el widget Select2Widget #}
                {% if form.contrato_individual.errors %}<ul class="error-messages">{% for error in form.contrato_individual.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.contrato_individual.help_text %}<small class="form-text text-muted">{{ form.contrato_individual.help_text }}</small>{% endif %}
            </div>

            {# Campo Contrato Colectivo (Select2) #}
            <div class="dark-group {% if form.contrato_colectivo.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.contrato_colectivo.id_for_label }}">üìë {{ form.contrato_colectivo.label }}</label>
                {{ form.contrato_colectivo }} {# Renderiza el widget Select2Widget #}
                {% if form.contrato_colectivo.errors %}<ul class="error-messages">{% for error in form.contrato_colectivo.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.contrato_colectivo.help_text %}<small class="form-text text-muted">{{ form.contrato_colectivo.help_text }}</small>{% endif %}
            </div>

            {# Campo Intermediario (Select2) #}
            <div class="dark-group {% if form.intermediario.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.intermediario.id_for_label }}">ü§ù {{ form.intermediario.label }}</label>
                {{ form.intermediario }} {# Renderiza el widget Select2Widget #}
                {% if form.intermediario.errors %}<ul class="error-messages">{% for error in form.intermediario.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.intermediario.help_text %}<small class="form-text text-muted">{{ form.intermediario.help_text }}</small>{% endif %}
            </div>

            {# Campo Estatus Factura #}
            <div class="dark-group {% if form.estatus_factura.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.estatus_factura.id_for_label }}">üìä {{ form.estatus_factura.label }}</label>
                {{ form.estatus_factura }} {# Renderiza el widget Select #}
                {% if form.estatus_factura.errors %}<ul class="error-messages">{% for error in form.estatus_factura.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.estatus_factura.help_text %}<small class="form-text text-muted">{{ form.estatus_factura.help_text }}</small>{% endif %}
            </div>

            {# Campo Estatus Emisi√≥n #}
            <div class="dark-group {% if form.estatus_emision.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.estatus_emision.id_for_label }}">üì¶ {{ form.estatus_emision.label }}</label>
                {{ form.estatus_emision }} {# Renderiza el widget Select #}
                {% if form.estatus_emision.errors %}<ul class="error-messages">{% for error in form.estatus_emision.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.estatus_emision.help_text %}<small class="form-text text-muted">{{ form.estatus_emision.help_text }}</small>{% endif %}
            </div>

             {# Campo Aplica IGTF (Switch) #}
             <div class="dark-group {% if form.aplica_igtf.errors %}error{% endif %}">
                 <label class="dark-label" for="{{ form.aplica_igtf.id_for_label }}">üí≤ {{ form.aplica_igtf.label }}</label>
                 <label class="switch"> {# Label envolvente para el estilo switch #}
                     {{ form.aplica_igtf }} {# Renderiza el <input type="checkbox"> #}
                     <span class="slider"></span> {# Span para el estilo CSS #}
                 </label>
                 {% if form.aplica_igtf.errors %}<ul class="error-messages">{% for error in form.aplica_igtf.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                 {% if form.aplica_igtf.help_text %}<small class="form-text text-muted">{{ form.aplica_igtf.help_text }}</small>{% endif %}
             </div>

            {# CAMPO PAGADA EXCLUIDO DEL FORMULARIO (Se calcula autom√°ticamente) #}
            <div class="dark-group">
                <label class="dark-label">Pagada</label>
                <span>{% if form.instance.pagada %}S√≠{% else %}No{% endif %}</span>
            </div>

        </div> {# Fin dark-grid #}
      </fieldset>

      {# --- Fieldset: Detalles del Recibo --- #}
      <fieldset>
        <legend class="dark-label">üßæ Detalles del Recibo</legend>
        <div class="dark-grid">

            {# Campo Monto #}
            <div class="dark-group {% if form.monto.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.monto.id_for_label }}">üí∞ {{ form.monto.label }}</label>
                {{ form.monto }} {# Renderiza NumberInput #}
                {% if form.monto.errors %}<ul class="error-messages">{% for error in form.monto.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.monto.help_text %}<small class="form-text text-muted">{{ form.monto.help_text }}</small>{% endif %}
            </div>

            {# CAMPO MONTO PENDIENTE EXCLUIDO (Se calcula) #}
            <div class="dark-group">
                <label class="dark-label">Monto Pendiente</label>
                <span>{{ form.instance.monto_pendiente|default:"0.00" }}</span>
            </div>

            {# Campo D√≠as Periodo Cobro #}
            <div class="dark-group {% if form.dias_periodo_cobro.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.dias_periodo_cobro.id_for_label }}">‚è≥ {{ form.dias_periodo_cobro.label }}</label>
                {{ form.dias_periodo_cobro }} {# Renderiza NumberInput #}
                {% if form.dias_periodo_cobro.errors %}<ul class="error-messages">{% for error in form.dias_periodo_cobro.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.dias_periodo_cobro.help_text %}<small class="form-text text-muted">{{ form.dias_periodo_cobro.help_text }}</small>{% endif %}
            </div>

            {# CAMPOS NUMERO_RECIBO y RELACION_INGRESO EXCLUIDOS (Autogenerados) #}

        </div> {# Fin dark-grid #}
      </fieldset>

      {# --- Fieldset: Vigencia del Recibo --- #}
      <fieldset>
        <legend class="dark-label">üóìÔ∏è Vigencia del Recibo</legend>
        <div class="dark-grid">

             {# Campo Vigencia Desde #}
            <div class="dark-group {% if form.vigencia_recibo_desde.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.vigencia_recibo_desde.id_for_label }}">üóìÔ∏è {{ form.vigencia_recibo_desde.label }}</label>
                {{ form.vigencia_recibo_desde }} {# Renderiza DateInput #}
                {% if form.vigencia_recibo_desde.errors %}<ul class="error-messages">{% for error in form.vigencia_recibo_desde.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.vigencia_recibo_desde.help_text %}<small class="form-text text-muted">{{ form.vigencia_recibo_desde.help_text }}</small>{% endif %}
            </div>

            {# Campo Vigencia Hasta #}
            <div class="dark-group {% if form.vigencia_recibo_hasta.errors %}error{% endif %}">
                <label class="dark-label" for="{{ form.vigencia_recibo_hasta.id_for_label }}">üóìÔ∏è {{ form.vigencia_recibo_hasta.label }}</label>
                {{ form.vigencia_recibo_hasta }} {# Renderiza DateInput #}
                {% if form.vigencia_recibo_hasta.errors %}<ul class="error-messages">{% for error in form.vigencia_recibo_hasta.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                {% if form.vigencia_recibo_hasta.help_text %}<small class="form-text text-muted">{{ form.vigencia_recibo_hasta.help_text }}</small>{% endif %}
            </div>

        </div> {# Fin dark-grid #}
      </fieldset>

      {# --- Fieldset: Observaciones --- #}
      <fieldset>
          <legend class="dark-label">üìù Observaciones</legend>
          {# Hacer que ocupe todo el ancho del grid si solo hay un campo #}
          <div class="dark-group {% if form.observaciones.errors %}error{% endif %}" style="grid-column: 1 / -1;">
              <label class="dark-label" for="{{ form.observaciones.id_for_label }}">üìù {{ form.observaciones.label }}</label>
              {{ form.observaciones }} {# Renderiza Textarea #}
              {% if form.observaciones.errors %}<ul class="error-messages">{% for error in form.observaciones.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
              {% if form.observaciones.help_text %}<small class="form-text text-muted">{{ form.observaciones.help_text }}</small>{% endif %}
          </div>
      </fieldset>

      {# --- Campos Ocultos --- #}
      {% for field in form.hidden_fields %}
          {{ field }}
      {% endfor %}

      {# --- Botones de Acci√≥n --- #}
      <div class="form-actions">
        <button type="submit" class="btn btn-success">{% if form.instance.pk %}üíæ Actualizar Factura{% else %}‚ûï Crear Factura{% endif %}</button>
        <a href="{% url 'myapp:factura_list' %}" class="btn btn-danger" style="margin-left: 15px;">üö´ Cancelar</a>
      </div>
    </form>
  </section>
</div>
{% endblock content %}

{# --- Bloque extra_scripts (si no est√° en base.html) --- #}
{% block extra_scripts %}
    {# Si jQuery y form.media.js NO est√°n en base.html, c√°rgalos aqu√≠ #}
    {# <script src="{% static 'jquery-3.7.1.min.js' %}"></script> #}
    {# {% if form.media.js %}{{ form.media.js }}{% endif %} #}
    {# Puedes a√±adir JS espec√≠fico para esta p√°gina si es necesario #}
{% endblock %}