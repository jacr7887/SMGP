{% extends "home.html" %}
{% load static humanize %}
{% load querystring_tags %} {# Si usas query_transform para los enlaces de volver #}

{% block content %}
<div class="dark-container" role="main" aria-labelledby="main-heading">
  <section>
    <h1 id="main-heading">ğŸ—‘ï¸ Confirmar EliminaciÃ³n de Usuario #{{ object.pk }}</h1> {# TÃ­tulo ajustado #}

    <div class="header-actions">
        <a href="{% url 'myapp:usuario_detail' object.pk %}" class="nav_link" aria-label="Cancelar y volver al detalle del usuario">
            â¬…ï¸ Cancelar y Volver al Detalle
        </a>
         <a href="{% url 'myapp:usuario_list' %}" class="nav_link" aria-label="Volver al listado de usuarios">
            â¬…ï¸ Volver al Listado
        </a>
    </div>

    <div class="delete-confirmation mt-3" data-section="confirmacion-eliminacion">
        <h2 class="dark-label">âš ï¸ ConfirmaciÃ³n de EliminaciÃ³n</h2>
        <p>EstÃ¡s a punto de eliminar permanentemente el siguiente registro de usuario. Verifica los datos:</p>

        {# --- Resumen de Datos Clave del Usuario --- #}
        <div class="detail-summary mb-3">
            <div class="detail-section"> 
                <h3 class="section-title visually-hidden">Datos Principales del Usuario</h3>
                <div class="dark-group"><span class="dark-label">#ï¸âƒ£ ID:</span><span class="data-value">{{ object.pk }}</span></div>
                <div class="dark-group"><span class="dark-label">ğŸ‘¤ Nombre Completo:</span><span class="data-value">{{ object.get_full_name|default:"No disponible" }}</span></div>
                <div class="dark-group"><span class="dark-label">ğŸ“§ Correo:</span><span class="data-value">{{ object.email|default:"No disponible" }}</span></div>
                <div class="dark-group"><span class="dark-label">ğŸ”‘ Tipo de Usuario:</span><span class="data-value">{{ object.get_tipo_usuario_display|default:"No disponible" }}</span></div>
                <div class="dark-group"><span class="dark-label">ğŸ¢ Departamento:</span><span class="data-value">{{ object.get_departamento_display|default:"No disponible" }}</span></div>
                <div class="dark-group"><span class="dark-label">â˜ï¸ TelÃ©fono:</span><span class="data-value">{{ object.telefono|default:"No disponible" }}</span></div>
                {# <div class="dark-group"><span class="dark-label">ğŸ  DirecciÃ³n:</span><span class="data-value">{{ object.direccion|truncatechars:50|default:"No disponible" }}</span></div> #}
                <div class="dark-group"><span class="dark-label">ğŸ”’ Nivel de Acceso:</span><span class="data-value">{{ object.get_nivel_acceso_display|default:"No disponible" }}</span></div>
                <div class="dark-group"><span class="dark-label">ğŸ’¡ Estado Cuenta (Personalizado):</span><span class="badge {% if object.activo %}badge-success{% else %}badge-danger{% endif %}">{{ object.activo|yesno:"Activa,Inactiva" }}</span></div>
                <div class="dark-group"><span class="dark-label">âœ… Estado Django (is_active):</span><span class="badge {% if object.is_active %}badge-success{% else %}badge-danger{% endif %}">{{ object.is_active|yesno:"Activa,Inactiva" }}</span></div>
            </div>
        </div>
        {# --- Fin Resumen de Datos --- #}

        {# --- LÃ³gica de Advertencia Mejorada --- #}
        {# Asume que la vista pasa 'usuario_puede_ser_eliminado' (booleano) y 'mensaje_bloqueo_eliminacion' (string) al contexto #}
        {% if not usuario_puede_ser_eliminado %} {# Si la vista determina que NO se puede eliminar #}
            <div class="alert alert-danger mt-4" role="alert">
                <p><strong>Â¡AcciÃ³n Bloqueada!</strong> Este usuario **no puede ser eliminado**.</p>
                {% if mensaje_bloqueo_eliminacion %}
                    <p>{{ mensaje_bloqueo_eliminacion }}</p>
                {% else %}
                    <p>Puede tener registros asociados importantes o es un usuario protegido.</p>
                {% endif %}
            </div>
        {% else %}
            <div class="alert alert-warning mt-4" role="alert">
                <p><strong>Â¡AtenciÃ³n!</strong> Esta acciÃ³n no se puede deshacer.</p>
                <p>Si eliminas este usuario, todos sus datos y asociaciones podrÃ­an perderse o quedar huÃ©rfanos.</p>
                <p>Â¿EstÃ¡s completamente seguro de que deseas eliminar a <strong>{{ object.get_full_name|default:object.username }}</strong>?</p>
            </div>
        {% endif %}
        {# --- FIN LÃ³gica de Advertencia --- #}

        {# --- Formulario de ConfirmaciÃ³n --- #}
        <form method="post" class="delete-form mt-3" aria-label="Formulario de confirmaciÃ³n de eliminaciÃ³n">
            {% csrf_token %}
            <div class="form-actions">
                <button type="submit" class="btn-warning" {% if not usuario_puede_ser_eliminado %}disabled title="{{ mensaje_bloqueo_eliminacion|default:'No se puede eliminar este usuario.' }}"{% endif %} aria-label="Confirmar la eliminaciÃ³n permanente de este usuario">
                    ğŸ—‘ï¸ {% if not usuario_puede_ser_eliminado %}Eliminar (Bloqueado){% else %}Eliminar Definitivamente{% endif %}
                </button>
                
                <a href="{% url 'myapp:usuario_detail' object.pk %}" class="btn-success" aria-label="Cancelar y volver al detalle del usuario">
                    ğŸš« No, cancelar
                </a>
            </div>
        </form>
        {# --- Fin Formulario --- #}

    </div> {# Fin delete-confirmation #}
  </section>
</div>
{% endblock content %}