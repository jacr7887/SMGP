{% extends "home.html" %}
{% load static %}
{% load humanize %}

{% block extra_head %}
{# Solo cargamos el CSS base de DataTables. Los estilos ya est√°n en styles.css #}
{% endblock %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container" role="main" aria-labelledby="main-heading">
  <section>
    <h1 id="main-heading">üë• {{ title }}</h1>

    <div class="header-actions">
      {% if perms.myapp.add_usuario %}
      <a href="{% url 'myapp:usuario_create' %}" class="nav_link">
        ‚ûï Nuevo Usuario
      </a>
      {% endif %}
    </div>

    <div class="table-container">
      <table id="usuarios-table" class="data-table" style="width:100%">
        <thead>
          <tr>
            {# --- CABECERAS COMPLETAS PARA USUARIO --- #}
            <th>Nombre Completo</th>
            <th>Email</th>
            <th>Tipo</th>
            <th>Nivel</th>
            <th>Departamento</th>
            <th>Intermediario</th>
            <th>Activo</th>
            <th>Staff</th>
            <th>Superusuario</th>
            <th>√öltimo Login</th>
            <th>Fecha Registro</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in object_list %}
            {% if usuario.decryption_error %}
              <tr class="table-danger">
                <td colspan="12">‚ö†Ô∏è Error al leer datos para el usuario con ID: {{ usuario.pk }}.</td>
              </tr>
            {% else %}
              <tr>
                {# --- CELDAS COMPLETAS PARA USUARIO --- #}
                <td>{{ usuario.get_full_name|default:"N/A" }}</td>
                <td>{{ usuario.email|default:"N/A" }}</td>
                <td>{{ usuario.get_tipo_usuario_display }}</td>
                <td>{{ usuario.get_nivel_acceso_display }}</td>
                <td>{{ usuario.get_departamento_display|default:"-" }}</td>
                <td>{{ usuario.intermediario.nombre_completo|default:"-" }}</td>
                <td class="text-center">
                  {% if usuario.activo %}
                    <span class="badge badge-success">S√≠</span>
                  {% else %}
                    <span class="badge badge-danger">No</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if usuario.is_staff %}
                    <span class="badge badge-info">S√≠</span>
                  {% else %}
                    <span>No</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if usuario.is_superuser %}
                    <span class="badge badge-warning">S√≠</span>
                  {% else %}
                    <span>No</span>
                  {% endif %}
                </td>
                <td>{{ usuario.last_login|date:"d/m/Y H:i"|default:"Nunca" }}</td>
                <td>{{ usuario.date_joined|date:"d/m/Y" }}</td>
                <td class="actions">
                  <div class="action-group">
                    <a href="{% url 'myapp:usuario_detail' usuario.pk %}" class="action-icon" title="Ver Detalles">üëÅÔ∏è</a>
                    <a href="{% url 'myapp:usuario_update' usuario.pk %}" class="action-icon" title="Editar">‚úèÔ∏è</a>
                    {% if request.user.pk != usuario.pk %} {# No permitir borrarse a uno mismo #}
                    <a href="{% url 'myapp:usuario_delete' usuario.pk %}" class="action-icon delete-link" title="Eliminar">‚ùå</a>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock content %}

{% block extra_scripts %}

{% endblock %}