{% extends "home.html" %}
{% load static %}
{% load humanize %}

{% block extra_head %}
{# Solo cargamos el CSS base de DataTables. Los estilos ya est√°n en styles.css #}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css">
{% endblock %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container" role="main" aria-labelledby="main-heading">
  <section>
    <h1 id="main-heading">üè∑Ô∏è {{ title }}</h1>

    <div class="header-actions">
      {% if perms.myapp.add_tarifa %}
      <a href="{% url 'myapp:tarifa_create' %}" class="nav_link">
        ‚ûï Nueva Tarifa
      </a>
      {% endif %}
    </div>

    <div class="table-container">
      <table id="tarifas-table" class="data-table" style="width:100%">
        <thead>
          <tr>
            {# --- CABECERAS COMPLETAS PARA TARIFA --- #}
            <th>C√≥digo</th>
            <th>Ramo</th>
            <th>Rango Etario</th>
            <th>Monto Anual</th>
            <th>Fecha Aplicaci√≥n</th>
            <th>Fraccionamiento</th>
            <th>Activo</th>
            <th>F. Creaci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for tarifa in object_list %}
              <tr>
                {# --- CELDAS COMPLETAS PARA TARIFA --- #}
                <td>{{ tarifa.codigo_tarifa|default:"-" }}</td>
                <td>{{ tarifa.get_ramo_display }}</td>
                <td>{{ tarifa.get_rango_etario_display }}</td>
                <td class="text-end">${{ tarifa.monto_anual|floatformat:2|intcomma|default:"0.00" }}</td>
                <td>{{ tarifa.fecha_aplicacion|date:"d/m/Y" }}</td>
                <td>{{ tarifa.get_tipo_fraccionamiento_display|default:"N/A" }}</td>
                <td class="text-center">
                  {% if tarifa.activo %}
                    <span class="badge badge-success">S√≠</span>
                  {% else %}
                    <span class="badge badge-danger">No</span>
                  {% endif %}
                </td>
                <td>{{ tarifa.fecha_creacion|date:"d/m/Y H:i" }}</td>
                <td class="actions">
                  <div class="action-group">
                    <a href="{% url 'myapp:tarifa_detail' tarifa.pk %}" class="action-icon" title="Ver Detalles">üëÅÔ∏è</a>
                    <a href="{% url 'myapp:tarifa_update' tarifa.pk %}" class="action-icon" title="Editar">‚úèÔ∏è</a>
                    <a href="{% url 'myapp:tarifa_delete' tarifa.pk %}" class="action-icon delete-link" title="Eliminar">‚ùå</a>
                  </div>
                </td>
              </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock content %}

{% block extra_scripts %}
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>

<script>
$(document).ready(function() {
    $('#tarifas-table').DataTable({
        // Traducci√≥n local para evitar errores de carga
        language: {
            "processing": "Procesando...",
            "lengthMenu": "Mostrar _MENU_ registros",
            "zeroRecords": "No se encontraron resultados",
            "emptyTable": "Ning√∫n dato disponible en esta tabla",
            "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
            "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
            "infoFiltered": "(filtrado de un total de _MAX_ registros)",
            "search": "Buscar:",
            "loadingRecords": "Cargando...",
            "paginate": {
                "first": "Primero",
                "last": "√öltimo",
                "next": "Siguiente",
                "previous": "Anterior"
            },
            "aria": {
                "sortAscending": ": Activar para ordenar la columna de manera ascendente",
                "sortDescending": ": Activar para ordenar la columna de manera descendente"
            }
        },
        "dom":
            "<'dt-layout-row'<'dt-layout-cell dt-start'l><'dt-layout-cell dt-end'f>>" +
            "<'dt-layout-row'<'dt-layout-cell dt-full-width'tr>>" +
            "<'dt-layout-row'<'dt-layout-cell dt-start'i><'dt-layout-cell dt-end'p>>",
        "columnDefs": [
            { "orderable": false, "targets": -1 } // Deshabilita ordenar en la √∫ltima columna (Acciones)
        ]
    });
});
</script>
{% endblock %}