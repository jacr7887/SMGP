{% extends "home.html" %}
{% load static humanize %}
{% load querystring_tags %} {# Si usas query_transform #}

{% block content %}
<div class="dark-container" role="main" aria-labelledby="main-heading"> {# Tu clase #}
  <section>
    <h1 id="main-heading">ğŸ—‘ï¸ Confirmar EliminaciÃ³n de Tarifa #{{ object.id }}</h1> {# TÃ­tulo ajustado #}

    <div class="header-actions">
        {# Enlace a detalle usa object.pk #}
        <a href="{% url 'myapp:tarifa_detail' object.pk %}" class="nav_link" aria-label="Cancelar y volver al detalle de la tarifa">
            â¬…ï¸ Cancelar y Volver al Detalle
        </a>
         <a href="{% url 'myapp:tarifa_list' %}" class="nav_link" aria-label="Volver al listado de tarifas">
            â¬…ï¸ Volver al Listado
        </a>
    </div>

    <div class="delete-confirmation mt-3" data-section="confirmacion-eliminacion"> {# Margen aÃ±adido #}
        <h2 class="dark-label">âš ï¸ ConfirmaciÃ³n de EliminaciÃ³n</h2> {# Tu clase dark-label #}
        <p>EstÃ¡s a punto de eliminar permanentemente el siguiente registro de tarifa. Verifica los datos:</p>

        {# --- Resumen de Datos Clave (Usando tu estructura) --- #}
        <div class="detail-summary mb-3"> {# AÃ±adido margen inferior #}
            <div class="detail-section"> 
                <h3 class="section-title visually-hidden">Datos Principales de la Tarifa</h3>
                <div class="dark-group"><span class="dark-label">#ï¸âƒ£ Codigo de Tarifa:</span><span class="data-value">{{ object.codigo_tarifa|default:"No disponible" }}</span></div>
                 <div class="dark-group"><span class="dark-label">#ï¸âƒ£ ID:</span><span class="data-value">{{ object.pk }}</span></div>
                 <div class="dark-group"><span class="dark-label">ğŸŒ¿ Ramo:</span><span class="data-value">{{ object.get_ramo_display|escape }}</span></div>
                 <div class="dark-group"><span class="dark-label">ğŸ” Rango Etario:</span><span class="data-value">{{ object.get_rango_etario_display|escape }}</span></div>
                 <div class="dark-group"><span class="dark-label">ğŸ“… F. AplicaciÃ³n:</span><span class="data-value">{{ object.fecha_aplicacion|date:"d/m/Y" }}</span></div>
                 <div class="dark-group"><span class="dark-label">ğŸ’° Monto Anual:</span><span class="data-value">${{ object.monto_anual|floatformat:2|intcomma }}</span></div>
                 <div class="dark-group"><span class="dark-label">ìª¼ Fraccionamiento:</span><span class="data-value">{{ object.get_tipo_fraccionamiento_display|escape|default:"Anual (Base)" }}</span></div>
                 <div class="dark-group"><span class="dark-label">ğŸ’¡ Activo:</span><span class="badge {% if object.activo %}badge-success{% else %}badge-danger{% endif %}">{{ object.activo|yesno:"SÃ­,No" }}</span></div>
            </div>
             {# Omitimos la secciÃ³n de auditorÃ­a aquÃ­, es menos relevante para confirmar borrado #}
        </div>
        {# --- Fin Resumen de Datos --- #}

        {# --- NUEVO: LÃ³gica de Advertencia Mejorada --- #}
        {# Asume que la vista pasa 'tarifa_en_uso' (booleano) al contexto #}
        {% if tarifa_en_uso %}
            <div class="alert alert-danger mt-4" role="alert"> {# Alerta de Peligro si estÃ¡ en uso #}
                <p><strong>Â¡AcciÃ³n Bloqueada!</strong> Esta tarifa **no puede ser eliminada** porque estÃ¡ siendo utilizada actualmente por uno o mÃ¡s contratos.</p>
                <p>Para poder eliminarla, primero debe desvincularla o asignar otra tarifa a los contratos asociados.</p>
            </div>
        {% else %}
            <div class="alert alert-warning mt-4" role="alert"> {# Advertencia normal si NO estÃ¡ en uso #}
                <p><strong>Â¡AtenciÃ³n!</strong> Esta acciÃ³n no se puede deshacer.</p>
                <p>Â¿EstÃ¡s completamente seguro de que deseas eliminar esta tarifa?</p>
            </div>
        {% endif %}
        {# --- FIN NUEVO --- #}


        {# --- Formulario de ConfirmaciÃ³n --- #}
        <form method="post" class="delete-form mt-3" aria-label="Formulario de confirmaciÃ³n de eliminaciÃ³n"> {# Margen aÃ±adido #}
            {% csrf_token %}
            <div class="form-actions"> {# Tu clase #}
                {# --- BotÃ³n Deshabilitado si estÃ¡ en uso --- #}
                <button type="submit" class="btn-warning" {% if tarifa_en_uso %}disabled title="No se puede eliminar: Tarifa en uso por contratos"{% endif %} aria-label="Confirmar la eliminaciÃ³n permanente de esta tarifa">
                    ğŸ—‘ï¸ {% if tarifa_en_uso %}Eliminar (Bloqueado){% else %}Eliminar Definitivamente{% endif %}
                </button>
                {# --- Fin BotÃ³n Deshabilitado --- #}

                {# BotÃ³n Cancelar siempre activo #}
                <a href="{% url 'myapp:tarifa_detail' object.pk %}" class="btn-success" aria-label="Cancelar y volver al detalle de la tarifa"> {# Tu clase #}
                    ğŸš« No, cancelar
                </a>
            </div>
        </form>
        {# --- Fin Formulario --- #}

    </div> {# Fin delete-confirmation #}
  </section>
</div>

{% endblock content %}