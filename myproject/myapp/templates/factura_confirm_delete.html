{% extends "home.html" %}
{% load static %}

{% block title %}âš ï¸ Confirmar EliminaciÃ³n Factura{% endblock title %}

{% block content %}
<div class="container" role="main" aria-labelledby="main-heading">
    <section>
        <h1 id="main-heading">âš ï¸ Confirmar EliminaciÃ³n Factura: {{ object.numero_recibo|escape|default:"[Sin NÃºmero]" }}</h1>

        <p>EstÃ¡s a punto de eliminar permanentemente la siguiente factura. Revisa los detalles:</p>

        {% if tiene_pagos %}
        <div class="alert alert-danger" role="alert"> {# Usar alert-danger para bloqueo #}
            <strong>Â¡OPERACIÃ“N BLOQUEADA!</strong> Esta factura tiene <strong>{{ cantidad_pagos }} pago{{ cantidad_pagos|pluralize:" ,s" }} asociado{{ cantidad_pagos|pluralize:" ,s" }}</strong> y no puede ser eliminada. Primero debe eliminar o desvincular los pagos.
        </div>
        {% else %}
        <div class="alert alert-warning" role="alert">
            <strong>Â¡Advertencia Importante!</strong> Esta acciÃ³n es <strong>irreversible</strong>.
        </div>
        {% endif %}

        <div class="form-main-container detail-summary mb-4">
            <fieldset class="mb-4">
                <legend>ğŸ‘¤ Datos del Titular</legend>
                <div class="dark-grid">
                    <div class="dark-group"><span class="dark-label">ğŸ‘¤ Nombre</span><span>{{ object.get_full_name_factura|escape|default:"-" }}</span></div>
                </div>
            </fieldset>

             <fieldset class="mb-4">
                <legend>ğŸ§¾ Detalles Factura</legend>
                <div class="dark-grid">
                    <div class="dark-group"><span class="dark-label">#ï¸âƒ£ ID</span><span>{{ object.id }}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ§¾ NÃºmero Recibo</span><span>{{ object.numero_recibo|escape|default:"-" }}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ—“ï¸ Vigencia</span><span>{{ object.vigencia_recibo_desde|date:"d/m/y" }} - {{ object.vigencia_recibo_hasta|date:"d/m/y" }}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ“… DÃ­as PerÃ­odo</span><span>{{ object.dias_periodo_cobro|default:"-" }}</span></div>
                </div>
            </fieldset>

            <fieldset class="mb-4">
                <legend>ğŸ”— Contrato e Intermediario</legend>
                 <div class="dark-grid">
                    <div class="dark-group"><span class="dark-label">ğŸ“œ Contrato</span><span>{% if object.contrato_individual %}{{ object.contrato_individual }}{% elif object.contrato_colectivo %}{{ object.contrato_colectivo }}{% else %}-{% endif %}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ¤ Intermediario</span><span>{{ object.intermediario|default:"-" }}</span></div>
                </div>
            </fieldset>

            <fieldset class="mb-4">
                <legend>ğŸ’² Montos y Pagos</legend>
                <div class="dark-grid">
                    <div class="dark-group"><span class="dark-label">ğŸ’² Monto Total</span><span>{{ object.monto|floatformat:2 }}</span></div>
                    <div class="dark-group"><span class="dark-label">â³ Monto Pendiente</span><span>{{ object.monto_pendiente|floatformat:2 }}</span></div>
                    <div class="dark-group"><span class="dark-label">âœ… Pagada</span><span>{% if object.pagada %}<span class="badge badge-success">SÃ­</span>{% else %}<span class="badge badge-danger">No</span>{% endif %}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ’² Aplica IGTF</span><span>{% if object.aplica_igtf %}<span class="badge badge-success">SÃ­</span>{% else %}<span class="badge badge-danger">No</span>{% endif %}</span></div> {# Nuevo #}
                    <div class="dark-group"><span class="dark-label">ğŸ”— NÂ° Rel. Ingreso</span><span>{{ object.relacion_ingreso|default:"-" }}</span></div>
                </div>
            </fieldset>

            <fieldset class="mb-4">
                <legend>ğŸ“Š Estatus y ConfiguraciÃ³n</legend>
                <div class="dark-grid">
                    <div class="dark-group"><span class="dark-label">âš¡ Activo</span><span>{% if object.activo %}<span class="badge badge-success">Activo</span>{% else %}<span class="badge badge-danger">Inactivo</span>{% endif %}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ“Š Estatus Factura</span><span>{{ object.get_estatus_factura_display }}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ“¨ Estatus EmisiÃ³n</span><span>{{ object.get_estatus_emision_display }}</span></div>
                </div>
            </fieldset>

            <fieldset class="mb-4"> {# Nuevo #}
                <legend>ğŸ“ Observaciones</legend>
                <div class="dark-grid">
                    <div class="dark-group" style="grid-column: 1 / -1;">
                         <span class="dark-label">ğŸ“ Observaciones</span>
                         {% if object.observaciones %}<p>{{ object.observaciones|escape|linebreaksbr }}</p>{% else %}<span>-</span>{% endif %}
                    </div>
                </div>
            </fieldset>

             <fieldset class="mb-4">
                <legend>â³ Metadatos</legend>
                 <div class="dark-grid">
                    <div class="dark-group"><span class="dark-label">â³ Creado</span><span>{{ object.fecha_creacion|date:"d/m/Y H:i" }}</span></div>
                    <div class="dark-group"><span class="dark-label">ğŸ”„ Modificado</span><span>{{ object.fecha_modificacion|date:"d/m/Y H:i" }}</span></div>
                </div>
            </fieldset>

        </div>

        <form method="post">
            {% csrf_token %}
            <div class="form-actions">
                {# El botÃ³n se deshabilita si hay pagos para evitar confusiÃ³n, aunque la vista lo bloquea #}
                <button type="submit" class="btn btn-warning" {% if tiene_pagos %}disabled title="No se puede eliminar: tiene pagos asociados"{% endif %}>
                    âœ”ï¸ SÃ­, eliminar permanentemente
                </button>
                <a href="{{ object.get_absolute_url }}" class="btn btn-success" style="margin-left: 15px;">âŒ No, cancelar</a>
            </div>
        </form>

    </section>
</div>
{% endblock content %}