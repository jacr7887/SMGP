{% extends "home.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container" role="main" aria-labelledby="main-heading">
  <section>
    <h1 id="main-heading">üìã Detalle de Auditor√≠a del Sistema #{{ object.pk }}</h1>

    <div class="header-actions">
      <a href="{% url 'myapp:auditoria_sistema_list' %}" class="nav_link" aria-label="Volver al listado de auditor√≠as">
        ‚¨ÖÔ∏è Volver al Listado
      </a>
      {# Opcional: Permitir editar/eliminar auditor√≠a (generalmente no recomendado) #}
      {% if perms.myapp.change_auditoriasistema %}
      <a href="{% url 'myapp:auditoria_sistema_update' object.pk %}" class="nav_link" aria-label="Editar auditor√≠a {{ object.pk }}">
        ‚úèÔ∏è Editar
      </a>
      {% endif %}
      {% if perms.myapp.delete_auditoriasistema %}
      <a href="{% url 'myapp:auditoria_sistema_delete' object.pk %}" class="nav_link delete-link" aria-label="Eliminar auditor√≠a {{ object.pk }}">
        ‚ùå Eliminar
      </a>
      {% endif %}
    </div>

    <div class="form-main-container"> {# Usando la clase de otros detalles #}

      <fieldset class="mb-4">
          <legend>‚ÑπÔ∏è Detalles de la Acci√≥n</legend>
          <div class="dark-grid">
            <div class="dark-group">
                <span class="dark-label">#Ô∏è‚É£ ID Registro:</span>
                <span>{{ object.pk }}</span>
            </div>
            <div class="dark-group">
                <span class="dark-label">üîÑ Tipo de Acci√≥n:</span>
                <span>{{ object.get_tipo_accion_display|default:object.tipo_accion }}</span>
            </div>
            <div class="dark-group">
                <span class="dark-label">‚úÖ Resultado:</span>
                 <span class="badge {% if object.resultado_accion == 'EXITO' %}badge-success{% elif object.resultado_accion == 'ERROR' %}badge-danger{% else %}badge-secondary{% endif %}">
                     {{ object.get_resultado_accion_display|default:object.resultado_accion }}
                 </span>
            </div>
            <div class="dark-group">
                <span class="dark-label">üë§ Usuario:</span>
                <span>{{ object.usuario.get_full_name|default:object.usuario.username|default:"Sistema" }}</span>
            </div>
             <div class="dark-group">
                <span class="dark-label">üì¶ Tabla Afectada:</span>
                <span>{{ object.tabla_afectada|default:"N/A" }}</span>
            </div>
            <div class="dark-group">
                <span class="dark-label">üî¢ ID Registro Afectado:</span>
                <span>{{ object.registro_id_afectado|default:"N/A" }}</span>
            </div>
             <div class="dark-group" style="grid-column: span 2;">
                <span class="dark-label">üìù Detalle de Acci√≥n:</span>
                 <p style="margin:0; white-space: pre-wrap;">{{ object.detalle_accion|escape|default:"-" }}</p>
            </div>
          </div>
      </fieldset>

      <fieldset>
          <legend>‚öôÔ∏è Informaci√≥n T√©cnica y de Tiempo</legend>
           <div class="dark-grid">
              <div class="dark-group">
                <span class="dark-label">üåê Direcci√≥n IP:</span>
                <span>{{ object.direccion_ip|default:"-" }}</span>
              </div>
              <div class="dark-group" style="grid-column: span 2;">
                <span class="dark-label">üì± Agente de Usuario:</span>
                <p style="margin:0; word-break: break-all;">{{ object.agente_usuario|escape|default:"-" }}</p>
              </div>
              <div class="dark-group">
                <span class="dark-label">‚è∞ Tiempo de Inicio:</span>
                <span>{{ object.tiempo_inicio|date:"d/m/Y H:i:s.u" }}</span> {# Mostrar microsegundos #}
              </div>
              <div class="dark-group">
                <span class="dark-label">‚è≥ Tiempo Final:</span>
                <span>{{ object.tiempo_final|date:"d/m/Y H:i:s.u"|default:"-" }}</span> {# Mostrar microsegundos #}
              </div>
              <div class="dark-group">
                <span class="dark-label">‚è±Ô∏è Control Fecha Actual:</span>
                <span>{{ object.control_fecha_actual|date:"d/m/Y H:i:s.u" }}</span> {# Mostrar microsegundos #}
              </div>
               {# Opcional: Calcular duraci√≥n si existe tiempo final #}
               {% if object.tiempo_final and object.tiempo_inicio %}
               <div class="dark-group">
                  <span class="dark-label">‚è±Ô∏è Duraci√≥n:</span>
                   <span>{{ object.tiempo_final|timesince:object.tiempo_inicio }}</span> {# Usar timesince #}
                   {# O para m√°s precisi√≥n: {{ tiempo_proceso }} segundos (calculado en la vista) #}
               </div>
               {% endif %}
           </div>
      </fieldset>

    </div>
  </section>
</div>

{% endblock %}