FROM python:3.11-slim
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV PIP_NO_CACHE_DIR=off
ENV PIP_DISABLE_PIP_VERSION_CHECK=on

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    libpq-dev \
    # build-essential gcc # Descomenta si pip install falla por compilación
    && rm -rf /var/lib/apt/lists/*

RUN pip install --upgrade pip

# Copia requirements.txt (desde el contexto myproject/) a /app/ en la imagen
COPY requirements.txt ./requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# Copia entrypoint.sh (desde el contexto myproject/) a /app/ en la imagen
COPY entrypoint.sh ./entrypoint.sh
# Asegura permisos de ejecución DENTRO de la imagen
RUN chmod +x /app/entrypoint.sh 

# Copia todo el contenido del contexto actual (myproject/) a /app/
COPY . .

EXPOSE 8000
RUN ls -la /app/entrypoint.sh && cat /app/entrypoint.sh && head -n 1 /app/entrypoint.sh | od -c
# El ENTRYPOINT ahora buscará entrypoint.sh en /app/
ENTRYPOINT ["/app/entrypoint.sh"]